{% extends "layout.html" %}

{% block title %}Home{% endblock %}

{% block main %}
<div id="confirm" style="cursor: pointer;"></div>
<h1>Announcements</h1>
{% for announcement in data %}
    <div class="card" style="margin: 16px 0 16px 0;">
        <h3>{{ announcement["name"] }}</h3>
        <p class="dt">{{ announcement["date"] }}</p>
        {{ announcement["description"] | safe }}
        {% if session["admin"] %}
        <a href="/admin/editannouncement/{{ announcement["id"] }}" style="position: absolute; top: 12px; right: 36px;">
            <img src="/assets/images/pencil.svg" onerror="this.src='/assets/images/pencil.png'" style="width: 16px;">
        </a>
        <a aid="{{ announcement["id"] }}" href="#" onclick="deletemsg(this)" style="position: absolute; top: 12px; right: 16px;">
            <img src="/assets/images/trash.svg" onerror="this.src='/assets/images/trash.png'" style="width: 16px;">
        </a>
        {% endif %}
    </div>
{% endfor %}
<script>
    document.querySelectorAll(".dt").forEach(function (e) {
        var split = e.innerHTML.split(" ");
            var date_split = split[0].split("-");
            var final = date_split[1] + "/" + date_split[2] + "/" + date_split[0] + " " + split[1];
        var parsed = new Date(final + " UTC").toString().split(" ");
        e.innerHTML = "Posted: " + parsed[1] + " " + parsed[2] + ", " + parsed[3] + " " + parsed[4];
        e.classList.remove("dt");
    });

    function deleteAnnouncement(e) {
        var aid = e.getAttribute("aid");
        window.location.href = "/admin/deleteannouncement?aid=" + aid;
    }

    function deletemsg(e) {
        var id = $(e).attr("aid")
        var msg = `
            <div class="alert alert-danger show" role="alert">
                Are you sure you want to delete this announcement? Click this message to confirm.
            </div>`;
        $("#confirm").html(msg)
                     .attr("aid", id)
                     .attr("onclick", "deleteAnnouncement(this)");
    }
</script>
{% endblock %}
